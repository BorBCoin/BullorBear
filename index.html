<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bull or Bear Coin ($BorB)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="#about">About</a></li>
                <li><a href="proof-of-chance.html">Proof of Chance</a></li> <!-- Proof of Chance link -->
                <li><a href="#social">Social</a></li>
            </ul>
        </nav>
        <h1>Welcome to Bull or Bear Coin ($BorB)</h1>
        <p>Your new daily trading opportunity with a unique dynamic</p>
    </header>

    <main>
        <section class="content">
            <h2>Today's Sentiment:</h2>
            <p id="sentiment">Loading...</p>
            <h2 id="countdown-display">Time remaining: 60 seconds</h2> <!-- Display countdown -->
        </section>

        <button id="get-started-btn">Start Your Trading Journey with $BorB</button>
    </main>

    <footer>
        <p>&copy; 2025 Bull or Bear Coin. All rights reserved.</p>
        <nav>
            <a href="proof-of-chance.html">Proof of Chance</a> | 
            <a href="#social">Social</a> | 
            <a href="privacy.html">Privacy Policy</a> | 
            <a href="terms.html">Terms of Service</a>
        </nav>
    </footer>

    <script src="script.js"></script>

    <!-- Add logic to handle fetching the sentiment data -->
    <script>
        async function fetchSentiment() {
            try {
                const response = await fetch('https://bullorbear.onrender.com/api/sentiment'); // Updated URL
                const data = await response.json();
                
                const sentiment = data.sentiment;
                const lastUpdatedTime = data.lastUpdatedTime;

                // Update the sentiment on the page
                const sentimentElement = document.getElementById("sentiment");
                sentimentElement.textContent = sentiment;
                sentimentElement.style.color = "#FFD700"; // Bright yellow for both Bullish and Bearish

                // Store the data in localStorage for fallback
                localStorage.setItem("sentiment", sentiment);
                localStorage.setItem("lastUpdatedTime", lastUpdatedTime);

                // Change background color based on sentiment
                document.body.style.backgroundColor = sentiment === "Bullish" ? "green" : "red";

                if (sentiment === "Bullish") {
                    startConfetti();
                }
            } catch (error) {
                console.error("Error fetching sentiment:", error);
            }
        }

        // Update countdown logic
        function updateCountdown(lastUpdatedTime) {
            const countdownDisplay = document.getElementById("countdown-display");

            function calculateRemainingTime() {
                const elapsedTime = Math.floor((Date.now() - lastUpdatedTime) / 1000);
                return Math.max(60 - elapsedTime, 0);
            }

            function updateDisplay() {
                let countdown = calculateRemainingTime();
                countdownDisplay.textContent = `Time remaining: ${countdown} seconds`;

                if (countdown === 0) {
                    fetchSentiment(); // Reset sentiment when countdown hits 0
                    updateCountdown(Date.now()); // Restart countdown from current time
                }
            }

            updateDisplay();
            setInterval(updateDisplay, 1000); // Update every second
        }

        // Initialize page with data
        window.onload = async function () {
            const sentiment = localStorage.getItem("sentiment");
            const lastUpdatedTime = parseInt(localStorage.getItem("lastUpdatedTime"), 10);

            // If no sentiment or if one minute has passed, fetch data from server
            if (!sentiment || isNaN(lastUpdatedTime)) {
                await fetchSentiment(); // Fetch data from the server if necessary
            } else {
                // Use stored sentiment and update the page with it
                document.getElementById("sentiment").textContent = sentiment;
                document.body.style.backgroundColor = sentiment === "Bullish" ? "green" : "red";
            }

            updateCountdown(lastUpdatedTime); // Start countdown
        };
    </script>
</body>
</html>
